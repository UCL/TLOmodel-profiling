<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Handling Statistics &#8212; TLO Model: Profiling  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Supporting functions using GitPython" href="git-tree.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="handling-statistics">
<h1>Handling Statistics<a class="headerlink" href="#handling-statistics" title="Link to this heading">¶</a></h1>
<p>The statistics that we gather from the profiling runs can have multiple purposes.
Some are to be collected and plotted across multiple profiling runs; such as the CPU time or memory usage.
Others may hold information specific to a particular profiling run that provides information about how to
replicate the profiling results; like the commit SHA of the model that was profiled, workflow trigger
that set the profiling run off, and the time the run was triggered.</p>
<p>The statistics that are to be read from the profiling outputs are stored as <a class="reference internal" href="#profiling_statistics.Statistic" title="profiling_statistics.Statistic"><code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.Statistic</span></code></a> objects (these can then be grouped into a <code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.StatisticsCollection</span></code>, which is a convenient wrapper class).
The <code class="docutils literal notranslate"><span class="pre">profiling_statistics.py</span></code> file then defines a static variable, <code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.STATS</span></code>, which corresponds to the statistics that the profiling workflow on the main repository produce and which should be read-able from the output files.
If the profiling workflow is edited to produce different or additional statistics, or changes the format in which they
are saved, the corresponding entries in <code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.STATS</span></code> should be updated / added accordingly.
They will then automatically be handled by the <a class="reference internal" href="builder.html#builder.Builder" title="builder.Builder"><code class="xref py py-class docutils literal notranslate"><span class="pre">builder.Builder</span></code></a>.</p>
<section id="the-statistic-class">
<h2>The <code class="docutils literal notranslate"><span class="pre">Statistic</span></code> class<a class="headerlink" href="#the-statistic-class" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="profiling_statistics.Statistic">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">profiling_statistics.</span></span><span class="sig-name descname"><span class="pre">Statistic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">key_in_stats_file:</span> <span class="pre">str,</span> <span class="pre">plot_title:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">dtype:</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">dataframe_col_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">plot_y_label:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">plot_svg_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">converter:</span> <span class="pre">~typing.Callable[[~typing.Any],</span> <span class="pre">~typing.Any]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">default_value:</span> <span class="pre">~typing.Any</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#profiling_statistics.Statistic" title="Link to this definition">¶</a></dt>
<dd><p>A general class for tracking information about a statistic captured by the profiling run.</p>
<p>An instance of this class must have a <code class="docutils literal notranslate"><span class="pre">key_in_stats_file</span></code> corresponding to a key
which appears in the statistics files produced by the profiling workflow.
This key will be used to extract the value of that statistic from the files.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">plot_title</span></code> is specified, the statistic is flagged to be plotted across multiple
profiling runs. The corresponding webpage will include a plot of the value of this
statistic across all available profiling runs.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dtype</span></code> member can be used to ensure correct type casting occurs when reading statistics from files.
Similarly, the <code class="docutils literal notranslate"><span class="pre">converter</span></code> attribute can be passed a function which acts on the value read from the statistics file, and saves the result as the value of the statistic. This can be used to avoid manual steps
in the build process, such as converting timestamps (floats) to datetimes.</p>
<p><code class="docutils literal notranslate"><span class="pre">dataframe_col_name</span></code> is the name displayed in the lookup table for the statistic, and also the column name used internally by the <a class="reference internal" href="builder.html#builder.Builder" title="builder.Builder"><code class="xref py py-class docutils literal notranslate"><span class="pre">builder.Builder</span></code></a> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">plot_y_label</span></code> and <code class="docutils literal notranslate"><span class="pre">plot_svg_name</span></code> can be configured to change elements of the plot that is produced.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">default_value</span></code> will be used when the statistic cannot be read from a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key_in_stats_file</strong> (<em>str</em>) – Key in the statistics files produced by the profiling workflow that holds the value this statistic.</p></li>
<li><p><strong>plot_title</strong> (<em>str</em><em>, </em><em>optional</em>) – The title to display in the plot (showing change over time) of this statistic. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (default), then no plot will be produced for this statistic.</p></li>
<li><p><strong>dtype</strong> (<em>type</em><em>, </em><em>optional</em>) – The Python <code class="docutils literal notranslate"><span class="pre">type</span></code> that the statistic should be read as. Defaults to <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p></li>
<li><p><strong>dataframe_col_name</strong> (<em>str</em><em>, </em><em>optional</em>) – The column name in the <a class="reference internal" href="builder.html#builder.Builder" title="builder.Builder"><code class="xref py py-class docutils literal notranslate"><span class="pre">builder.Builder</span></code></a> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and lookup table to use for this statistic. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (default), use the <code class="docutils literal notranslate"><span class="pre">key_in_stats_file</span></code> value.</p></li>
<li><p><strong>plot_y_label</strong> (<em>str</em><em>, </em><em>optional</em>) – The y-axis label to assign to the plot of this statistic across profiling runs. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (default), use the <code class="docutils literal notranslate"><span class="pre">plot_title</span></code>.</p></li>
<li><p><strong>plot_svg_name</strong> (<em>str</em><em>, </em><em>optional</em>) – Name under which to save the plot svg that will be produced. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (default), auto-generate a unique filename.</p></li>
<li><p><strong>default_value</strong> (<em>Any</em><em>, </em><em>optional</em>) – Default value to assign to the statistic if it cannot be read or is missing from a statistics file. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> to flag missing data.</p></li>
<li><p><strong>converter</strong> (<em>Callable</em><em>[</em><em>[</em><em>Any</em><em>] </em><em>Any</em><em>]</em><em>, </em><em>optional</em>) – A function to apply to the value read from the statistics file, with the result saved as the value of the statistic.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="profiling_statistics.Statistic.dtype">
<span class="sig-name descname"><span class="pre">dtype</span></span><a class="headerlink" href="#profiling_statistics.Statistic.dtype" title="Link to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="profiling_statistics.Statistic.produces_plot">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">produces_plot</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#profiling_statistics.Statistic.produces_plot" title="Link to this definition">¶</a></dt>
<dd><p>Whether this statistic should produce a plot of its value across profiling runs.</p>
</dd></dl>

</dd></dl>

<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h3>
<p>Define a statistic whose key in the statistics files is “<em>trigger</em>”, should be saved as a string, and displayed in the lookup table under the heading “<em>Triggered by</em>”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Statistic</span><span class="p">(</span><span class="s2">&quot;trigger&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">dataframe_col_name</span><span class="o">=</span><span class="s2">&quot;Triggered by&quot;</span><span class="p">),</span>
</pre></div>
</div>
<p>Define a statistic containing a duration of time.
The value as read from the “duration” field in the statistics file actually contains the time duration in seconds, and we want it in minutes.
As such, pass a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> function to the converter field so that Python knows to run this conversion when reading this statistic from the files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">convert</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t_secs</span><span class="p">:</span> <span class="n">t_secs</span> <span class="o">/</span> <span class="mf">60.</span>
<span class="n">Statistic</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">dataframe_col_name</span><span class="o">=</span><span class="s2">&quot;Session duration (min)&quot;</span><span class="p">,</span> <span class="n">converter</span> <span class="o">=</span> <span class="n">convert</span><span class="p">),</span>
</pre></div>
</div>
</section>
</section>
<section id="collections-of-statistic-s">
<h2>Collections of <code class="docutils literal notranslate"><span class="pre">Statistic</span></code> s<a class="headerlink" href="#collections-of-statistic-s" title="Link to this heading">¶</a></h2>
<p>The <a class="reference internal" href="#profiling_statistics.StatisticCollection" title="profiling_statistics.StatisticCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.StatisticCollection</span></code></a> class provides a convenient wrapper for looping through the statistics that we gather from the profiling runs.</p>
<dl class="py class">
<dt class="sig sig-object py" id="profiling_statistics.StatisticCollection">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">profiling_statistics.</span></span><span class="sig-name descname"><span class="pre">StatisticCollection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">stats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#profiling_statistics.Statistic" title="profiling_statistics.Statistic"><span class="pre">Statistic</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#profiling_statistics.StatisticCollection" title="Link to this definition">¶</a></dt>
<dd><p>A collection of Statistic objects.</p>
<p>Defines convenient wrapper functions for extracting one particular attribute from
each statistic in the collection, and for reading the values of all the statistics
from a file using a single function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>statistics</strong> (List[<a class="reference internal" href="#profiling_statistics.Statistic" title="profiling_statistics.Statistic"><code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.Statistic</span></code></a>]) – A list of statistics that should be collected - and plotted where requested.</p>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="profiling_statistics.StatisticCollection.is_empty">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">is_empty</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#profiling_statistics.StatisticCollection.is_empty" title="Link to this definition">¶</a></dt>
<dd><p>Return True if this instance contains no Statistics.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="profiling_statistics.StatisticCollection.read_from_file">
<span class="sig-name descname"><span class="pre">read_from_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">branch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">string</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#profiling_statistics.StatisticCollection.read_from_file" title="Link to this definition">¶</a></dt>
<dd><p>Parse the statistics in this collection from the values provided in the file, or
a string with the parsed contents.
File (or string representing parsed file) should be parse-able as a json.</p>
<p>Values are returned in the order that the .values() method returns their names.
If values cannot be found, defaults are assigned (usually None to flag missing data).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file</strong> – A json-readable file containing values of the statistics in this collection.</p></li>
<li><p><strong>branch</strong> – If provided, read the file from an alternative branch to the one that is currently checked-out.</p></li>
<li><p><strong>string</strong> – A string representing a parsed json file, which is of the format described previously.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of values that correspond to the values of the statistics in this collection, extracted from the input file.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="profiling_statistics.StatisticCollection.values">
<span class="sig-name descname"><span class="pre">values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attribute</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#profiling_statistics.StatisticCollection.values" title="Link to this definition">¶</a></dt>
<dd><p>For each Statistic in the collection, return the value stored under the attribute provided.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">[s.attribute</span> <span class="pre">for</span> <span class="pre">s</span> <span class="pre">in</span> <span class="pre">self.statistics]</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="example-the-stats-constant">
<h3>Example: The <code class="docutils literal notranslate"><span class="pre">STATS</span></code> constant<a class="headerlink" href="#example-the-stats-constant" title="Link to this heading">¶</a></h3>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.STATS</span></code> constant initialises a <a class="reference internal" href="#profiling_statistics.StatisticCollection" title="profiling_statistics.StatisticCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.StatisticCollection</span></code></a> instance which defines all of the variables we expect to receive in the profiling-workflow-produced-statistics files.
The <a class="reference internal" href="builder.html#builder.Builder" title="builder.Builder"><code class="xref py py-class docutils literal notranslate"><span class="pre">builder.Builder</span></code></a> references this constant when constructing the profiling results website; so if future updates add another statistic to the profiling outputs, an additional <a class="reference internal" href="#profiling_statistics.Statistic" title="profiling_statistics.Statistic"><code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.Statistic</span></code></a> can be added to the <code class="xref py py-class docutils literal notranslate"><span class="pre">profiling_statistics.STATS</span></code> constant, and it will be automatically included in the next build of the website.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../documentation.html">TLO Model: Profiling</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Profiling Runs: Lookup Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run-statistics.html">Run Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Developer Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api-reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../documentation.html">Documentation overview</a><ul>
  <li><a href="../api-reference.html">API Reference</a><ul>
      <li>Previous: <a href="git-tree.html" title="previous chapter">Supporting functions using <code class="docutils literal notranslate"><span class="pre">GitPython</span></code></a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023, Thanzi la Onse.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/api/profiling-statistics.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>